# Weighted Monte Carlo with Gaussian Kernel (DWTS Ranking Inference)

本程序是对 "Dancing with the Stars" (DWTS) 粉丝排名推断模型的进阶实现，采用了更严谨的统计学方法来量化选手偏好的时序一致性。

## 1. 程序工作流程 (Workflow)

程序采用 **“硬约束筛选 + 软约束贝叶斯加权”** 的多级推断逻辑：

1.  **数据清洗与初始化**：解析 `2026_MCM_Problem_C_Data.csv`，将评委原始分数转换为标准排名，识别各赛季每周的活跃选手及淘汰事实。
2.  **幸存者偏差修正 (Survivor Bias Correction)**：
    *   在每一周模拟开始前，程序会根据上一周的估计结果，剔除已淘汰选手并对剩余选手进行排名重映射。
    *   这确保了由于其他选手离场导致的“自然排名上升”不会被模型误判为“粉丝偏好波动”。
3.  **自适应采样策略 (Adaptive Sampling)**：
    *   计算全排列总数 $N!$。
    *   **全排列模式**：若 $N! \le ITERATIONS$，则枚举所有可能，确保数学上的绝对精确。
    *   **随机采样模式**：若 $N! > ITERATIONS$，则执行随机排列采样，在计算资源与精度间取得平衡。
4.  **双重推断逻辑**：
    *   **硬约束 (Hard Constraint)**：丢弃所有模拟结果中淘汰者与历史事实不符的样本。
    *   **高斯核加权 (Gaussian Kernel Weighting)**：基于贝叶斯重要性采样原理，对通过硬约束的样本计算权重。样本与上周“预期排名”越接近者，权重越高。公式为：$w_i = \exp\left(-\frac{\sum(Rank_{curr} - Rank_{exp})^2}{2\sigma^2}\right)$。
5.  **加权统计输出**：计算加权均值和加权标准差，并输出 ESS 指标以评估结果质量。

## 2. 核心算法与方法论 (Methods)

*   **贝叶斯重要性采样 (Bayesian Importance Sampling)**：将上一周的粉丝表现作为先验信息，通过权重分配来优化本周的参数估计。
*   **高斯核函数 (Gaussian Kernel)**：利用指数衰减模拟粉丝偏好的连续性。$\sigma$ 参数控制了模型对“偏好剧烈变动”的容忍度。
*   **有效样本量 (ESS - Effective Sample Size)**：通过 $\frac{(\sum w)^2}{\sum w^2}$ 计算，反映了加权后的统计效力。ESS 越高，说明估计结果越稳健。

## 3. 相较于老版本的升级 (Upgrades)

| 特性 | 老版本 (Simple MC) | 新版本 (Weighted MC) |
| :--- | :--- | :--- |
| **权重逻辑** | 简单过滤，合格样本等权对待 | **贝叶斯重要性加权**，利用时序信息 |
| **偏差修正** | 忽略选手淘汰对排名的移位影响 | **内置幸存者偏差修正**，区分自然变动与偏好波动 |
| **采样灵活性** | 固定次数随机采样 | **自适应策略**：小规模全排列 (精确)，大规模随机采样 (高效) |
| **估算稳健性** | 易受极端异常排列干扰 | **高斯平滑**，有效过滤不符合逻辑的剧烈名次跳动 |
| **统计指标** | 仅均值/标准差 | **加权统计 + ESS 指标**，可量化模拟结果的可信度 |

## 4. 全局配置参数

在文件开头可以集中配置以下核心参数：
*   `SIGMA`：控制粉丝偏好的稳定性。值越小，模型越倾向于认为粉丝排名应保持稳定。
*   `ITERATIONS`：设定采样上限。建议设置为 $100,000$ 以兼顾大多数周次的计算速度。
